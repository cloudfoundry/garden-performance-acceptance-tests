# GPATs

These are the Garden Performance Acceptance Tests.

## About

These tests run as part of the
[garden-runcpipeline](https://garden.ci.cf-app.com/) and will gate us from
shipping a new release if they fail. With this in mind, the goal is to keep
this test suite as minimal and quick as possible.

Metrics generated by the test suite are currently sent to Wavefront. This is
achieved by wiring up the custom [Wavefront
Reporter](https://github.com/cloudfoundry/garden-performance-acceptance-tests/blob/master/reporter/wavefront.go)
into Ginkgo. In the future, should we wish to send metrics to other services,
we can extend the suite by writing and wiring up a new custom reporter for that
service.

Note that the reporter package used here is based on this [reporter
package](https://github.com/cloudfoundry/benchmarkbbs/tree/master/reporter)
from the
[cloudfoundry/benchmarkbbs](https://github.com/cloudfoundry/benchmarkbbs) repo.

## Usage

```
WAVEFRONT_TOKEN="x" WAVEFRONT_URL="x" WAVEFRONT_SOURCE="x" GARDEN_ADDRESS="127.0.0.1:7777" ginkgo
```

This assumes that there is a garden server running locally. Instructions on how
to easily spin up a lite deployment can be found
[here](https://github.com/cloudfoundry/garden-runc-release#running). You can
also point the tests to a remote server.

**NB**: This test suite will destroy ALL containers on the Garden server as
part of the run. You have been warned. ````

```

## Conditionally Expect Metrics

This suite is used both to gate releases via expectations on performance but
also to provide metrics when thresholds are succeeded.

To achieve this, metrics related expectations are wrapped in Conditionally()
functions, to ensure they only fail tests when required.

To turn off metrics related expectations, set the `IGNORE_PERF_EXPECTATIONS`
environment variable
```
